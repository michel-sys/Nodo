<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sala de Chat</title>
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="/img/Nodo Icon.png" type="image/x-icon">
</head>
<body>
  <div class="chat-container">
    <h2 id="sala-titulo"></h2>
    <div id="chat-box" class="chat-box"></div>

    <div class="chat-input">
      <input type="text" id="mensagem" placeholder="Digite sua mensagem...">
      <button id="enviar">Enviar</button>
    </div>
  </div>

<script type="module">
  // Importações do Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

  // Config do seu projeto (corrigi o storageBucket)
  const firebaseConfig = {
    apiKey: "AIzaSyDbMYoQ0tgiM1SZVHngVqogckLXO-JrF7o",
    authDomain: "chat-nodo.firebaseapp.com",
    databaseURL: "https://chat-nodo-default-rtdb.firebaseio.com",
    projectId: "chat-nodo",
    storageBucket: "chat-nodo.appspot.com",
    messagingSenderId: "703306329093",
    appId: "1:703306329093:web:e041510d76c3e58725806c",
    measurementId: "G-DPDS3M9TNJ"
  };

  // Inicializa Firebase + Banco
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Pega a sala da URL
  const params = new URLSearchParams(window.location.search);
  const sala = params.get("sala");
  document.getElementById("sala-titulo").innerText = "Sala " + sala;

  const chatBox = document.getElementById("chat-box");
  const input = document.getElementById("mensagem");
  const btnEnviar = document.getElementById("enviar");

  // Enviar mensagem
  btnEnviar.addEventListener("click", () => {
    const texto = input.value.trim();
    if (texto) {
      push(ref(db, "salas/" + sala), {
        texto: texto,
        horario: new Date().toLocaleTimeString()
      });
      input.value = "";
    }
  });

  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") btnEnviar.click();
  });

  // Receber mensagens em tempo real
  onChildAdded(ref(db, "salas/" + sala), (snapshot) => {
    const msg = snapshot.val();
    const div = document.createElement("div");
    div.className = "mensagem";
    div.innerText = msg.texto + "  (" + msg.horario + ")";
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>

  </script>
</body>
</html>
